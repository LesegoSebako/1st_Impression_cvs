# ===== GZIP COMPRESSION =====
<IfModule mod_deflate.c>
  # Enable compression
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE image/svg+xml
  
  # Compress all output labeled with one of the following MIME-types
  <IfModule mod_filter.c>
    AddOutputFilterByType DEFLATE application/atom+xml \
                                  application/javascript \
                                  application/json \
                                  application/ld+json \
                                  application/manifest+json \
                                  application/rdf+xml \
                                  application/rss+xml \
                                  application/schema+json \
                                  application/vnd.geo+json \
                                  application/vnd.ms-fontobject \
                                  application/x-font-ttf \
                                  application/x-javascript \
                                  application/x-web-app-manifest+json \
                                  application/xhtml+xml \
                                  application/xml \
                                  font/eot \
                                  font/opentype \
                                  image/bmp \
                                  image/svg+xml \
                                  image/vnd.microsoft.icon \
                                  image/x-icon \
                                  text/cache-manifest \
                                  text/css \
                                  text/html \
                                  text/javascript \
                                  text/plain \
                                  text/vcard \
                                  text/vnd.rim.location.xloc \
                                  text/vtt \
                                  text/x-component \
                                  text/x-cross-domain-policy \
                                  text/xml
  </IfModule>
</IfModule>

# ===== BROWSER CACHING =====
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Images
  ExpiresByType image/jpg "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType image/svg+xml "access plus 1 month"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # CSS, JavaScript
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/x-javascript "access plus 1 month"
  
  # Fonts
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/eot "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  
  # HTML, XML
  ExpiresByType text/html "access plus 1 hour"
  ExpiresByType application/xhtml+xml "access plus 1 hour"
  ExpiresByType application/xml "access plus 1 hour"
  
  # PDF, documents
  ExpiresByType application/pdf "access plus 1 month"
  
  # Default
  ExpiresDefault "access plus 2 days"
</IfModule>

# ===== SECURITY HEADERS =====
<IfModule mod_headers.c>
  # Prevent MIME type sniffing
  Header always set X-Content-Type-Options nosniff
  
  # Prevent clickjacking
  Header always set X-Frame-Options DENY
  
  # Enable XSS protection
  Header always set X-XSS-Protection "1; mode=block"
  
  # Referrer policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  
  # Remove server information
  Header unset X-Powered-By
  Header always unset X-Powered-By
  ServerTokens Prod
  
  # Cache control for specific files
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico|css|js|woff|woff2)$">
    Header set Cache-Control "max-age=2592000, public"
  </FilesMatch>
</IfModule>

# ===== PERFORMANCE OPTIMIZATIONS =====
# Enable Keep-Alive
<IfModule mod_headers.c>
  Header set Connection keep-alive
</IfModule>

# Set Keep-Alive timeout (if supported)
<IfModule mod_headers.c>
  Header set Keep-Alive "timeout=30, max=100"
</IfModule>

# ===== FILE ACCESS RESTRICTIONS =====
# Block access to sensitive files
<FilesMatch "(\.htaccess|\.htpasswd|\.ini|\.log|\.sh|\.env|\.gitignore)$">
  Order Allow,Deny
  Deny from all
</FilesMatch>

# Protect against SQL injection
<IfModule mod_rewrite.c>
  RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
  RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]) [OR]
  RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z])
  RewriteRule ^(.*)$ - [F,L]
</IfModule>

# ===== ERROR PAGES =====
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# ===== URL REWRITING (Optional) =====
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Force HTTPS (uncomment if you have SSL)
  # RewriteCond %{HTTPS} off
  # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
  
  # Remove trailing slashes
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)/$ /$1 [L,R=301]
  
  # Redirect www to non-www (or vice versa - choose one)
  # RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
  # RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]
</IfModule>